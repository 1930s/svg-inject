<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>SVGInject Test 1</title>

  <style>
    img, svg {
      background: #f0f0f0;
    }

    #failed, #success, #running {
      font-size: 50px;
    }
    #failed {
      display: none;
      color: red;
    }

    #success {
      display: none;
      color: green;
    }

    #running {
      color: orange;
    }

    img, svg {
      width: 128px;
      height: 128px;
    }

    .inject-success .color-1 {
      color: #ff0000;
    }

    .inject-success .color-2 {
      color: #00ff00;
    }

    .inject-success .color-3 {
      color: #0000ff;
    }

    .inject-success .color-4 {
      color: #ffff00;
    }

    .inject-fail .color-1,
    .inject-fail .color-2,
    .inject-fail .color-3,
    .inject-fail .color-4 {
      color: #000000;
    }

    .inject-hide {
      position: absolute;
      left: -10000px;
      z-index: -1;
    }
  </style>

  <script src="svg-inject.js"></script>

  <script>
    var failed = false;
    var successCount = 0;

    var fail = function() {
      failed = true;
      document.getElementById('success').style.display = 'none';
      document.getElementById('failed').style.display = 'block';
      document.getElementById('running').style.display = 'none';
      throw new Error();
    };

    var success = function() {
      if (!failed && ++successCount == tests.length) {
        document.getElementById('success').style.display = 'block';
        document.getElementById('running').style.display = 'none';
      }
    };

    var testNotInjected = function(id) {

    };

    var testInjected = function(id) {

    };

    var tests = [
      // Test 1
      function() {
        var lastSVG = null;
        var sequenceNum = 0;
        var sequence = ['afterLoad', 'beforeInject', 'afterInject', 'beforeInject', 'afterInject', 'beforeInject', 'afterInject'];

        var testSequence = function(eventName) {
          if (sequenceNum === sequence.length || sequence[sequenceNum++] !== eventName) {
            fail();
          } else if (sequenceNum === sequence.length) {
            success();
          }
        };
        
        SVGInject.create('SVGInject1', {
          beforeInject: function(img, svg) {
            testSequence('beforeInject');

            if (lastSVG === svg) {
              fail();
            } else if (svg.parentNode && svg.parentNode.tagName == 'div') {
              fail();
            } else if (!img.parentNode) {
              fail();
            }

            lastSVG = svg;
          },
          afterInject: function(img, svg) {
            testSequence('afterInject');

            if (lastSVG !== svg) {
              fail();
            } else if (!svg.parentNode) {
              fail();
            } else if (img.parentNode) {
              fail();
            }
          },
          afterLoad: function(img, svgString) {
            testSequence('afterLoad');
          } 
        });  
      },

      // Test 2
      function() {
        var sequenceNum = 0;
        var sequence = [];
        for (var i = 0; i < 9; ++i) {
          sequence.push('beforeInject');
          sequence.push('afterInject');
        }

        var testSequence = function(eventName) {
          if (sequenceNum === sequence.length || sequence[sequenceNum++] !== eventName) {
            fail();
          } else if (sequenceNum === sequence.length) {
            success();
          }
        };
        
        SVGInject.create('SVGInject2', {
          beforeInject: function(img, svg) {
            testSequence('beforeInject');
          },
          afterInject: function(img, svg) {
            testSequence('afterInject');
          }
        });  
      },

      // Test 3
      function() {
        var includeAttributes = {
          'id': 'test_3_id',
          'class': 'inject-success',
          'data-test': 'test'
        };
        var notIncludeAttributes = ['src', 'onload', 'onerror', 'alt', 'title'];

        SVGInject.create('SVGInject3', {
          afterInject: function(img, svg) {
            for (var key in includeAttributes) {
              var val = includeAttributes[key];
              
              if (!svg.hasAttribute(key) || svg.getAttribute(key) !== val) {
                fail();
                return;
              }
            }

            for (var i = 0; i < notIncludeAttributes.length; ++i) {
              var notIncludeAttribute = notIncludeAttributes[i];

              if (svg.hasAttribute(notIncludeAttribute)) {
                fail();
                return;
              }
            }

            if (svg.firstChild.textContent !== 'businesspeople') {
              fail();
              return;
            }

            success();
          }
        });  
      },

      // Test 4
      function() {
        var notIncludeAttributes = ['id', 'data-test', 'onload', 'onerror', 'alt', 'title'];

        SVGInject.create('SVGInject4', {
          copyAttributes: false,
          beforeInject: function(img, svg) {
            svg.setAttribute('class', img.getAttribute('class'));
          },
          afterInject: function(img, svg) {
            for (var i = 0; i < notIncludeAttributes.length; ++i) {
              var notIncludeAttribute = notIncludeAttributes[i];

              if (svg.hasAttribute(notIncludeAttribute)) {
                fail();
                return;
              }

              if (svg.firstChild.tagName == 'title') {
              fail();
              return;
            }
            }
            success();
          }
        }); 
      },

      // Test 5
      function() {
        SVGInject.create('SVGInject5');

        var sequenceNum = 0;
        var sequence = [];
        for (var i = 0; i < 9; ++i) {
          if (i % 3 == 0) {
            sequence.push('afterLoad');
          }
          sequence.push('beforeInject');
          sequence.push('afterInject');
        }

        var testSequence = function(eventName) {
          if (sequenceNum === sequence.length || sequence[sequenceNum++] !== eventName) {
            fail();
          } else if (sequenceNum === sequence.length) {
            success();
          }
        };

        SVGInject5.setOptions({
          afterLoad: function() {
            testSequence('afterLoad')
          },
          beforeInject: function(img, svg) {
            testSequence('beforeInject');
          },
          afterInject: function(img, svg) {
            testSequence('afterInject');
          }
        });

        document.addEventListener("DOMContentLoaded", function(event) {
          SVGInject5(document.getElementsByClassName('test-5'));
        }); 
      },

      // Test 6
      function() {
        var count = 0;
        SVGInject.create('SVGInject6', {
          afterLoad: fail,
          beforeInject: fail,
          afterInject: fail,
          onFail: function(img) {
            img.src = 'imgs/test1.png';
            if (++count == 4) {
              success();
            }
          }
        });

        document.addEventListener("DOMContentLoaded", function(event) {
          SVGInject6(document.getElementsByClassName('test-6'));
        }); 
      }
    ];

    for (var i = 0; i < tests.length; ++i) {
      tests[i]();
    }
  </script>
</head>
<body>
  <div id="failed">FAILED</div>
  <div id="success">SUCCESS</div>
  <div id="running">RUNNING</div>

  <div>All Images must have the same color scheme</div>
  
  <div>Reference Images</div>
  <div>
    <img src="imgs/test1.png" />
    <img src="imgs/test2.png" />
    <img src="imgs/test3.png" />
  </div>

  <div>Test 1</div>
  <div>
    <!-- Test 1: multiple same images test -->
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_3" />
  </div>

  <div>Test 2</div>
  <div>
    <!-- Test 2: multiple different images test -->
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />
  </div>

  <div>Test 3</div>
  <div>
    <!-- Test 3: copy attribute test -->
    <img src="imgs/test1.svg" onload="SVGInject3(this)" onerror="SVGInject3.err(this, 'test1.png')" id="test_3_id" alt="businesspeople" title="businesspeople" class="inject-success" data-test="test" />

  <div>Test 4</div>
  <div>
    <!-- Test 4: custom copy attribute test -->
    <img src="imgs/test1.svg" onload="SVGInject4(this)" onerror="SVGInject4.err(this, 'test1.png')" id="test_4_id" alt="businesspeople" title="businesspeople" class="inject-success" data-test="test" />

  <div>Test 5</div>
  <div>  
    <!-- Test 5: directly call Javascript -->
    <img src="imgs/test1.svg" class="test-5 inject-success" />
    <img src="imgs/test2.svg" class="test-5 inject-success" />
    <img src="imgs/test3.svg" class="test-5 inject-success" />
    <img src="imgs/test1.svg" class="test-5 inject-success" />
    <img src="imgs/test2.svg" class="test-5 inject-success" />
    <img src="imgs/test3.svg" class="test-5 inject-success" />
    <img src="imgs/test1.svg" class="test-5 inject-success" />
    <img src="imgs/test2.svg" class="test-5 inject-success" />
    <img src="imgs/test3.svg" class="test-5 inject-success" />
  <div>

  <div>Test 6</div>
  <div>
    <!-- load fail test -->
    <img src="imgs/fail.svg" class="inject-fail" onload="SVGInject6(this)" onerror="SVGInject6.err(this)"/>
    <img src="imgs/fail.svg" class="inject-fail" onload="SVGInject6(this)" onerror="SVGInject6.err(this)"/>
    <img src="imgs/fail.svg" class="test-6 inject-fail">
    <img src="imgs/fail.svg" class="test-6 inject-fail">
  </div>
</body>
</html>