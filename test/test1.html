<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>SVGInject Test 1</title>

  <script src="svg-inject.js"></script>

  <script>
    var failed = false;
    var successCount = 0;
    var SUCCESS_NUM = 1;

    var fail = function() {
      failed = true;
      document.getElementById('success').style.display = 'none';
      document.getElementById('failed').style.display = 'block';
      document.getElementById('running').style.display = 'none';
      throw new Error();
    };

    var success = function() {
      if (!failed && ++successCount == SUCCESS_NUM) {
        document.getElementById('success').style.display = 'block';
        document.getElementById('running').style.display = 'none';
      }
    };

    var testNotInjected = function(id) {

    };

    var testInjected = function(id) {

    };

    // Test 1
    !function() {
      var lastSVG = null;
      var sequenceNum = 0;
      var sequence = ['afterLoad', 'beforeInject', 'afterInject', 'beforeInject', 'afterInject', 'beforeInject', 'afterInject'];

      var testSequence = function(eventName) {
        if (sequenceNum === sequence.length || sequence[sequenceNum++] !== eventName) {
          fail();
        } else if (sequenceNum === sequence.length) {
          success();
        }
      };
      
      SVGInject.create('SVGInject1', {
        beforeInject: function(img, svg) {
          testSequence('beforeInject');

          if (lastSVG === svg) {
            fail();
          } else if (svg.parentNode && svg.parentNode.tagName == 'div') {
            fail();
          } else if (!img.parentNode) {
            fail();
          }

          lastSVG = svg;
        },

        afterInject: function(img, svg) {
          testSequence('afterInject');

          if (lastSVG !== svg) {
            fail();
          } else if (!svg.parentNode) {
            fail();
          } else if (img.parentNode) {
            fail();
          }
        },

        afterLoad: function(img, svgString) {
          testSequence('afterLoad');
        } 
      });  
    }();

    // Test 2
    !function() {
      var sequenceNum = 0;
      var sequence = [];
      for (var i = 0; i < 9; ++i) {
        sequence.push('beforeInject');
        sequence.push('afterInject');
      }

      var testSequence = function(eventName) {
        if (sequenceNum === sequence.length || sequence[sequenceNum++] !== eventName) {
          fail();
        } else if (sequenceNum === sequence.length) {
          success();
        }
      };
      
      SVGInject.create('SVGInject2', {
        beforeInject: function(img, svg) {
          testSequence('beforeInject');

        },

        afterInject: function(img, svg) {
          testSequence('afterInject');
        }
      });  
    }();

    // Test 3
    !function() {
      var includeAttributes = [];
      var notIncludeAttributes = [];

      SVGInject.create('SVGInject3', {
        afterInject: function(img, svg) {
          svg.hasAttribute('onload')
        }
      });  
    }();
  </script>

  <style>
    #failed, #success, #running {
      font-size: 50px;
    }
    #failed {
      display: none;
      color: red;
    }

    #success {
      display: none;
      color: green;
    }

    #running {
      color: orange;
    }

    img, svg {
      width: 128px;
      height: 128px;
    }

    .inject-success .color-1 {
      color: #ff0000;
    }

    .inject-success .color-2 {
      color: #00ff00;
    }

    .inject-success .color-3 {
      color: #0000ff;
    }

    .inject-success .color-4 {
      color: #ffff00;
    }

    .inject-fail .color-1,
    .inject-fail .color-2,
    .inject-fail .color-3,
    .inject-fail .color-4 {
      color: #000000;
    }

    .inject-hide {
      position: absolute;
      left: -10000px;
      z-index: -1;
    }
  </style>

</head>
<body>
  <div id="failed">FAILED</div>
  <div id="success">SUCCESS</div>
  <div id="running">RUNNING</div>

  <div>All Images must have the same color scheme:</div>
  <div>
    <img src="imgs/test1.png" /> 

    <!-- Test 1: multiple same images test -->
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test1.svg" onload="SVGInject1(this)" onerror="SVGInject1.err(this, 'test1.png')" class="inject-success" id="test_1_3" />

    <!-- Test 2: multiple different images test -->
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />
    <img src="imgs/test1.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test1.png')" class="inject-success" id="test_1_1" />
    <img src="imgs/test2.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test2.png')" class="inject-success" id="test_1_2" />
    <img src="imgs/test3.svg" onload="SVGInject2(this)" onerror="SVGInject2.err(this, 'test3.png')" class="inject-success" id="test_1_3" />

    <!-- Test 3: copy attribute test -->
    <img src="imgs/test1.svg" onload="SVGInject3(this)" onerror="SVGInject3.err(this, 'test1.png')" id="copy_attribute" alt="businesspeople" title="businesspeople" class="inject-hide" data-test="test" />
    <img src="imgs/test1.svg" onload="SVGInject3(this)" onerror="SVGInject3.err(this, 'test1.png')" id="copy_attribute" alt="businesspeople" title="businesspeople" class="inject-hide" data-test="test" />

    <!-- load fail test -->
    <img src="imgs/test1.svg" class="inject-hide" onload="SVGInject(this)" alt="businesspeople" title="businesspeople"/>
  </div>

</body>
</html>